<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chuyển Đổi Số Sang Romaji (Phong cách Nhật - Tech)</title>
    <!-- Tải Tailwind CSS để sử dụng các class utility -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Tải Font Inter và các icon Font Awesome -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    
    <style>
        /* Cài đặt chung */
        body {
            font-family: 'Inter', sans-serif;
            margin: 0;
            min-height: 100vh;
            background-color: #f7f7f7; /* Nền xám nhạt */
            display: flex;
            align-items: center;
            justify-content: center;
            overflow-x: hidden;
            position: relative;
        }

        /* ------------------------------------- */
        /* HIỆU ỨNG NỀN MATRIX (Dark & Sharp) */
        /* ------------------------------------- */
        #matrix-background {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1; /* Nằm sau nội dung chính */
            opacity: 0.35; /* Đậm hơn phiên bản trước */
            filter: grayscale(0%) brightness(1.2) contrast(1.5); /* Sắc nét hơn, màu xanh nổi hơn */
        }

        /* Container ứng dụng */
        .app-container {
            position: relative;
            z-index: 5;
            max-width: 480px;
            width: 95%;
            padding: 30px;
            background-color: rgba(255, 255, 255, 0.95); /* Nền trắng trong suốt nhẹ */
            border-radius: 20px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1), 0 5px 15px rgba(0, 0, 0, 0.05);
            backdrop-filter: blur(5px); /* Hiệu ứng mờ nền */
            border: 2px solid #D1D5DB; /* Viền sáng */
        }
        
        /* Tiêu đề ứng dụng (Đỏ và Đen - Japan Style) */
        .app-title {
            font-size: 2.25rem;
            font-weight: 800;
            color: #1F2937; /* Xám than */
            letter-spacing: -0.05em;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        .hinomaru {
            width: 18px;
            height: 18px;
            background-color: #BC002D; /* Màu đỏ cờ Nhật */
            border-radius: 50%;
            box-shadow: 0 0 5px rgba(188, 0, 45, 0.5);
        }
        .subtitle {
            font-size: 0.9rem;
            color: #4B5563;
            text-align: center;
            margin-bottom: 25px;
            padding-top: 5px;
        }

        /* ------------------------------------- */
        /* STYLE CHO INPUT VÀ BUTTON */
        /* ------------------------------------- */
        .input-field {
            border: 1px solid #D1D5DB;
            border-radius: 10px;
            padding: 12px;
            transition: border-color 0.3s, box-shadow 0.3s;
        }
        .input-field:focus {
            border-color: #F87171; /* Màu đỏ nhạt */
            box-shadow: 0 0 0 3px rgba(248, 113, 113, 0.4);
        }

        .btn-primary {
            background-color: #BC002D; /* Đỏ Nhật Bản */
            color: white;
            padding: 12px 20px;
            border-radius: 10px;
            font-weight: 600;
            transition: background-color 0.2s, transform 0.2s, box-shadow 0.2s;
            box-shadow: 0 4px #990022; /* Shadow 3D nhẹ */
        }
        .btn-primary:hover {
            background-color: #A30027;
            transform: translateY(-1px);
            box-shadow: 0 5px #990022;
        }
        .btn-primary:active {
            transform: translateY(3px);
            box-shadow: 0 1px #990022;
        }
        
        /* ------------------------------------- */
        /* STYLE CHO HỘP KẾT QUẢ (HIGHLIGHT) */
        /* ------------------------------------- */
        .result-group {
            background: linear-gradient(135deg, #FFEEEE 0%, #FFFFFF 100%); /* Nền đỏ trắng gradient nhẹ */
            border: 2px solid #FCA5A5; /* Viền đỏ nhạt */
            border-radius: 15px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1), 0 0 15px rgba(252, 165, 165, 0.5); /* Glow nhẹ */
            transition: all 0.5s ease-in-out;
            transform: translateY(0);
            margin-top: 20px;
            padding: 20px;
        }

        #romajiOutput {
            font-family: monospace; /* Font công nghệ */
            font-size: 30px; 
            font-weight: 700; 
            color: #BC002D; /* Màu đỏ chính */
            text-align: center;
            text-shadow: 
                0 0 5px rgba(188, 0, 45, 0.3), /* Bóng tỏa sáng */
                0 0 1px rgba(188, 0, 45, 0.8); /* Bóng nét */
            line-height: 1.2;
            word-break: break-word; /* QUAN TRỌNG: Ngăn tràn viền */
        }

        #hiraganaOutput {
            font-size: 32px; /* Lớn hơn Romaji một chút */
            font-weight: 600; 
            color: #1F2937; /* Màu xám than (IT style) */
            text-align: center;
            padding-top: 10px;
            word-break: break-word; /* QUAN TRỌNG: Ngăn tràn viền */
        }

        .control-button {
            background-color: #FEE2E2;
            color: #BC002D;
            transition: background-color 0.2s, transform 0.2s;
        }
        .control-button:hover {
            background-color: #FCA5A5;
            color: white;
            transform: scale(1.05);
        }

        /* Style cho khối tùy chọn (Tương tự như giao diện phần mềm IT hiện đại) */
        .option-group {
            border: 1px solid #E5E7EB;
            border-radius: 10px;
            padding: 15px;
            background-color: #F9FAFB;
        }
    </style>
</head>
<body>

    <!-- Canvas cho hiệu ứng nền Matrix -->
    <canvas id="matrix-background"></canvas>

    <!-- Nội dung chính của ứng dụng -->
    <div class="app-container">
        
        <!-- HEADER (Japan Tech Style) -->
        <div class="header-content text-center mb-6">
            <div class="app-title">
                <span class="hinomaru"></span> <!-- Vòng tròn đỏ (Mặt trời mọc) -->
                Romaji Converter
                <span class="hinomaru"></span>
            </div>
            <p class="subtitle">Chuyển đổi số đếm tiếng Nhật (0 - 9,999,999)</p>
            <div class="text-xs text-gray-500 mt-2 p-1 bg-gray-100 rounded-full inline-block px-3">
                <i class="fas fa-microchip mr-1"></i> Hệ thống IT - Nhật Bản
            </div>
        </div>

        <!-- KHỐI TÙY CHỌN GIỌNG ĐỌC -->
        <div class="option-group mb-6">
            <h3 class="text-lg font-bold text-gray-700 mb-4 flex items-center">
                <i class="fas fa-sliders-h text-red-500 mr-2"></i> Tùy Chỉnh Giọng Đọc
            </h3>
            
            <div class="space-y-4 text-sm">
                <!-- Giọng Đọc -->
                <div class="flex flex-col">
                    <label for="voiceSelect" class="font-medium text-gray-600 mb-1">
                        <i class="fas fa-microphone text-blue-500 mr-1"></i> Giọng Đọc:
                    </label>
                    <select id="voiceSelect" class="input-field w-full">
                        <!-- Options will be populated by JavaScript -->
                    </select>
                </div>
                
                <!-- Tốc Độ -->
                <div class="flex flex-col">
                    <label for="rateRange" class="font-medium text-gray-600 mb-1 flex justify-between items-center">
                        <i class="fas fa-tachometer-alt text-gray-500 mr-1"></i> Tốc Độ:
                        <span id="rateValue" class="font-mono text-xs text-gray-600">1.0</span>
                    </label>
                    <input type="range" id="rateRange" min="0.5" max="2" value="1.0" step="0.1" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer">
                </div>
                
                <!-- Cao Độ -->
                <div class="flex flex-col">
                    <label for="pitchRange" class="font-medium text-gray-600 mb-1 flex justify-between items-center">
                        <i class="fas fa-wave-square text-gray-500 mr-1"></i> Cao Độ (Pitch):
                        <span id="pitchValue" class="font-mono text-xs text-gray-600">1.0</span>
                    </label>
                    <input type="range" id="pitchRange" min="0" max="2" value="1.0" step="0.1" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer">
                </div>
            </div>
        </div>

        <!-- KHỐI NHẬP SỐ VÀ CHUYỂN ĐỔI -->
        <div class="mb-8">
            <h3 class="text-lg font-bold text-gray-700 mb-4 flex items-center">
                <i class="fas fa-hashtag text-red-500 mr-2"></i> Nhập Số Cần Chuyển Đổi:
            </h3>
            
            <input type="number" id="inputNumber" placeholder="Ví dụ: 10000, 350000, 9999999" 
                   class="input-field w-full text-xl text-center text-gray-800 tracking-wide" 
                   min="0" max="9999999">
        </div>

        <!-- NÚT CHUYỂN ĐỔI -->
        <button id="convertButton" class="btn-primary w-full flex items-center justify-center gap-2">
            <i class="fas fa-exchange-alt"></i> Chuyển Đổi Ngay
        </button>

        <!-- KHỐI KẾT QUẢ -->
        <div id="resultBox" class="result-group hidden">
            
            <!-- Romaji Result -->
            <div class="mb-3">
                <div class="flex justify-between items-center mb-1">
                    <span class="text-sm font-semibold text-gray-700 flex items-center">
                        <i class="fas fa-check-circle text-green-500 mr-2"></i> Kết Quả Romaji:
                    </span>
                    <div class="space-x-2">
                        <button id="speakerButton" class="control-button px-3 py-1 rounded-full text-xs font-semibold">
                            <i class="fas fa-volume-up mr-1"></i> Đọc
                        </button>
                        <button id="copyRomajiButton" class="control-button px-3 py-1 rounded-full text-xs font-semibold">
                            <i class="fas fa-copy mr-1"></i> Copy R.
                        </button>
                    </div>
                </div>
                <div id="romajiOutput" class="text-2xl font-mono"></div>
            </div>

            <div class="border-t border-red-200 my-3"></div> <!-- Đường phân cách -->

            <!-- Hiragana Result -->
            <div>
                <div class="flex justify-between items-center mb-1">
                    <span class="text-sm font-semibold text-gray-700 flex items-center">
                        <i class="fas fa-book-open text-blue-500 mr-2"></i> Kết Quả Hiragana:
                    </span>
                    <button id="copyHiraganaButton" class="control-button px-3 py-1 rounded-full text-xs font-semibold">
                        <i class="fas fa-copy mr-1"></i> Copy H.
                    </button>
                </div>
                <div id="hiraganaOutput" class="text-2xl"></div>
            </div>
            
        </div>

        <!-- Hộp lỗi (Đỏ và Cảnh báo) -->
        <div id="errorMessage" class="hidden mt-4 p-4 text-sm text-red-700 bg-red-100 rounded-lg border border-red-300" role="alert">
            <i class="fas fa-exclamation-triangle mr-2"></i>
            <span id="errorText"></span>
        </div>
        
        <!-- FOOTER: THÔNG TIN TÁC GIẢ VÀ BÁCH KHOA HÀ NỘI -->
        <div class="app-footer">
            <img src="https://placehold.co/40x40/f7f7f7/9CA3AF?text=HUST" onerror="this.style.display='none'" class="hust-logo" alt="Logo ĐH Bách Khoa Hà Nội">
            <p class="text-xs font-medium text-gray-600">Đại học Bách Khoa Hà Nội (HUST)</p>
            <p class="text-xs text-gray-500">Phát triển bởi <span class="font-semibold text-red-500">Lợi Lê IT E6</span></p>
        </div>
        
    </div>

    <!-- MÃ JAVASCRIPT -->
    <script>
        // Các hàm tiện ích
        const $ = selector => document.querySelector(selector);
        const $$ = selector => document.querySelectorAll(selector);

        // --- CÀI ĐẶT MATRIX BACKGROUND (JAPANESE CODE STYLE) ---
        const canvas = $('#matrix-background');
        const ctx = canvas.getContext('2d');
        let width = window.innerWidth;
        let height = window.innerHeight;
        let columns;
        let drops;
        
        // Ký tự Katakana và Số - Nhật Bản
        const katakana = 'アァカサタナハマヤラワガザダバパイィキシチニヒミリヰギジヂビピウゥクスツヌフムユルグズブプエェケセテネヘメレヱゲゼデベペオォコソトノホモヨロヲゴゾドボポヴッン0123456789';
        const characters = katakana.split('');
        const fontSize = 16;
        
        function initMatrix() {
            width = window.innerWidth;
            height = window.innerHeight;
            canvas.width = width;
            canvas.height = height;
            
            columns = Math.floor(width / fontSize);
            drops = new Array(columns).fill(1); // Mảng giọt nước
            
            // Màu xanh lá cây đậm kiểu Neon
            ctx.fillStyle = "#000000";
            ctx.fillRect(0, 0, width, height);
        }
        
        window.addEventListener('resize', initMatrix);
        initMatrix();

        function draw() {
            // Lớp nền mờ: Tăng độ đậm bằng cách giảm 0.05 -> 0.02
            ctx.fillStyle = 'rgba(0, 0, 0, 0.02)';
            ctx.fillRect(0, 0, width, height);
            
            // Màu chữ code (Màu Xanh Neon đậm)
            ctx.fillStyle = '#00FF41'; 
            ctx.font = fontSize + 'px monospace'; // Font monospace cho cảm giác code
            
            for (let i = 0; i < drops.length; i++) {
                const text = characters[Math.floor(Math.random() * characters.length)];
                
                // Vẽ chữ
                ctx.fillText(text, i * fontSize, drops[i] * fontSize);
                
                // Reset giọt nước khi nó chạm đáy hoặc random (tỉ lệ 0.975)
                if (drops[i] * fontSize > height && Math.random() > 0.975) {
                    drops[i] = 0;
                }
                
                drops[i]++;
            }
        }
        
        setInterval(draw, 33); // Tốc độ vẽ

        // --- HÀM CHUYỂN ĐỔI CHÍNH: SỐ -> ROMAJI VÀ ROMAJI -> HIRAGANA ---
        
        const numberMap = {
            1: 'ichi', 2: 'ni', 3: 'san', 4: 'yon', 5: 'go', 6: 'roku', 7: 'nana', 8: 'hachi', 9: 'kyuu', 0: 'zero',
            10: 'juu', 100: 'hyaku', 1000: 'sen', 10000: 'man',
            300: 'sanbyaku', 600: 'roppyaku', 800: 'happyaku',
            3000: 'sanzen', 8000: 'hassen',
        };

        const hiraganaMap = {
            'a': 'あ', 'i': 'い', 'u': 'う', 'e': 'え', 'o': 'お',
            'ka': 'か', 'ki': 'き', 'ku': 'く', 'ke': 'け', 'ko': 'こ',
            'sa': 'さ', 'shi': 'し', 'su': 'す', 'se': 'せ', 'so': 'そ',
            'ta': 'た', 'chi': 'ち', 'tsu': 'つ', 'te': 'て', 'to': 'と',
            'na': 'な', 'ni': 'に', 'nu': 'ぬ', 'ne': 'ね', 'no': 'の',
            'ha': 'は', 'hi': 'ひ', 'fu': 'ふ', 'he': 'へ', 'ho': 'ほ',
            'ma': 'ま', 'mi': 'み', 'mu': 'む', 'me': 'め', 'mo': 'も',
            'ya': 'や', 'yu': 'ゆ', 'yo': 'よ',
            'ra': 'ら', 'ri': 'り', 'ru': 'る', 're': 'れ', 'ro': 'ろ',
            'wa': 'わ', 'wo': 'を', 'n': 'ん',
            'ga': 'が', 'gi': 'ぎ', 'gu': 'ぐ', 'ge': 'げ', 'go': 'ご',
            'za': 'ざ', 'ji': 'じ', 'zu': 'ず', 'ze': 'ぜ', 'zo': 'ぞ',
            'da': 'だ', 'de': 'で', 'do': 'ど',
            'ba': 'ば', 'bi': 'び', 'bu': 'ぶ', 'be': 'べ', 'bo': 'ぼ',
            'pa': 'ぱ', 'pi': 'ぴ', 'pu': 'ぷ', 'pe': 'ぺ', 'po': 'ぽ',
            
            // Âm dài và các âm đặc biệt (Đã được chuyển đổi trong hàm logic)
            'juu': 'じゅう', 'hyaku': 'ひゃく', 'sen': 'せん', 'man': 'まん', 'zero': 'ぜろ',
            
            'ichiman': 'いちまん',
            'sanbyaku': 'さんびゃく', 'roppyaku': 'ろっぴゃく', 'happyaku': 'はっぴゃく',
            'sanzen': 'さんぜん', 'hassen': 'はっせん',
            'ichi': 'いち', 'ni': 'に', 'san': 'さん', 'yon': 'よん', 'dama': 'だま',
            'go': 'ご', 'roku': 'ろく', 'nana': 'なな', 'hachi': 'はち', 'kyuu': 'きゅう',
            'juu': 'じゅう'
        };

        function romajiToHiragana(romaji) {
            // Chuẩn hóa Romaji để xử lý các từ ghép số đặc biệt
            // Tách các từ Romaji số đặc biệt
            for (const key in hiraganaMap) {
                if (key.length > 2) { // Chỉ xử lý các từ dài như juu, hyaku, ichiman, sanbyaku...
                    romaji = romaji.replace(new RegExp(key, 'g'), `__${key}__`);
                }
            }

            // Chia Romaji đã được xử lý thành các phần
            let parts = romaji.split('__').filter(p => p.length > 0);
            let hiragana = '';

            for (let part of parts) {
                if (hiraganaMap[part]) {
                    hiragana += hiraganaMap[part]; // Nếu là từ đặc biệt, sử dụng Hiragana đặc biệt
                } else {
                    // Xử lý các âm tiết còn lại (chủ yếu là các từ đơn vị 1-9 và "juu", "hyaku", "sen" còn sót lại)
                    
                    // Ví dụ: 20000 -> nijuuman. Cần xử lý từng phần
                    let temp = '';
                    let i = 0;
                    while (i < part.length) {
                        let matched = false;

                        // Ưu tiên khớp 3 ký tự (tsu, chi, shi, kyuu...)
                        if (i + 3 <= part.length && hiraganaMap[part.substring(i, i + 3)]) {
                            temp += hiraganaMap[part.substring(i, i + 3)];
                            i += 3;
                            matched = true;
                        } 
                        // Ưu tiên khớp 2 ký tự (sa, ki, ta...)
                        else if (i + 2 <= part.length && hiraganaMap[part.substring(i, i + 2)]) {
                            temp += hiraganaMap[part.substring(i, i + 2)];
                            i += 2;
                            matched = true;
                        } 
                        // Khớp 1 ký tự (n, a, i, u, e, o)
                        else if (i + 1 <= part.length && hiraganaMap[part.substring(i, i + 1)]) {
                            temp += hiraganaMap[part.substring(i, i + 1)];
                            i += 1;
                            matched = true;
                        }
                        // Xử lý âm 'n' và 't' đứng trước (như "sanzen" đã được xử lý ở trên, nhưng cần phòng trường hợp khác)
                        else if (part[i] === 't' && i + 1 < part.length && part[i + 1] === 's') {
                            temp += 'っ'; // Âm T nhỏ trước s
                            i += 1;
                            matched = true;
                        }
                        else if (part[i] === 'c' && i + 1 < part.length && part[i + 1] === 'h') {
                            temp += 'っ'; // Âm T nhỏ trước ch
                            i += 1;
                            matched = true;
                        }
                         else {
                            // Nếu không khớp, bỏ qua hoặc thêm nguyên văn (nên tránh)
                            console.warn("Lỗi chuyển đổi Hiragana ở Romaji: " + part.substring(i));
                            temp += part[i]; 
                            i++;
                        }
                    }
                    
                    // Xử lý âm kéo dài (oo, uu, ii, ee) -> ō, ū, ī, ē
                    // NOTE: Với số, thường không cần xử lý âm dài như shichi, kyuu đã có trong map.
                    
                    hiragana += temp;
                }
            }

            return hiragana;
        }


        function convertToRomaji(num) {
            if (num < 0 || num > 9999999) return "Số phải nằm trong khoảng 0 đến 9,999,999.";
            if (num === 0) return numberMap[0];

            let romaji = '';
            let tempNum = num;

            // Xử lý Hàng triệu (Man)
            if (tempNum >= 10000) {
                const manPart = Math.floor(tempNum / 10000);
                tempNum %= 10000;
                
                if (manPart > 1) {
                    romaji += convertLessThan10000(manPart) + 'man';
                } else if (manPart === 1) {
                    romaji += 'ichiman'; // 10,000 thường là ichiman
                }
            }

            // Xử lý Hàng ngàn, Trăm, Chục, Đơn vị (Dưới 10000)
            if (tempNum > 0) {
                romaji += convertLessThan10000(tempNum);
            }

            // Loại bỏ trường hợp chuỗi rỗng
            return romaji.trim() || convertLessThan10000(num);
        }

        function convertLessThan10000(n) {
            let s = '';
            let num = n;

            // Xử lý Hàng ngàn (Sen)
            if (num >= 1000) {
                const sen = Math.floor(num / 1000);
                num %= 1000;
                
                if (sen === 3) s += 'sanzen'; 
                else if (sen === 8) s += 'hassen';
                else if (sen === 1) s += 'sen';
                else s += numberMap[sen] + 'sen';
            }

            // Xử lý Hàng trăm (Hyaku)
            if (num >= 100) {
                const hyaku = Math.floor(num / 100);
                num %= 100;
                
                if (hyaku === 1) s += 'hyaku';
                else if (hyaku === 3) s += 'sanbyaku';
                else if (hyaku === 6) s += 'roppyaku';
                else if (hyaku === 8) s += 'happyaku';
                else s += numberMap[hyaku] + 'hyaku';
            }

            // Xử lý Hàng chục (Juu)
            if (num >= 10) {
                const juu = Math.floor(num / 10);
                num %= 10;
                s += (juu === 1 ? 'juu' : numberMap[juu] + 'juu');
            }

            // Xử lý Đơn vị
            if (num > 0) {
                s += numberMap[num];
            }
            return s;
        }

        // --- LOGIC GIAO DIỆN VÀ SỰ KIỆN ---

        const inputNumber = $('#inputNumber');
        const convertButton = $('#convertButton');
        const resultBox = $('#resultBox');
        const romajiOutput = $('#romajiOutput');
        const hiraganaOutput = $('#hiraganaOutput');
        const speakerButton = $('#speakerButton');
        const copyRomajiButton = $('#copyRomajiButton');
        const copyHiraganaButton = $('#copyHiraganaButton');
        const errorMessage = $('#errorMessage');
        const errorText = $('#errorText');

        // Speech Synthesis API
        let voices = [];
        const voiceSelect = $('#voiceSelect');
        const rateRange = $('#rateRange');
        const pitchRange = $('#pitchRange');
        const rateValue = $('#rateValue');
        const pitchValue = $('#pitchValue');
        
        function populateVoiceList() {
            voices = speechSynthesis.getVoices();
            voiceSelect.innerHTML = '';
            
            // Tìm kiếm giọng đọc tiếng Nhật (ja-JP)
            const jaVoice = voices.find(voice => voice.lang === 'ja-JP' || voice.name.includes('Japanese'));
            
            // Tạo option cho giọng đọc Nhật Bản (ưu tiên)
            const defaultOption = document.createElement('option');
            defaultOption.textContent = jaVoice ? `${jaVoice.name} (${jaVoice.lang})` : 'Microsoft Ayumi - Japanese (ja-JP)';
            defaultOption.value = jaVoice ? jaVoice.name : 'Microsoft Ayumi';
            defaultOption.selected = true;
            voiceSelect.appendChild(defaultOption);

            // Thêm tất cả các giọng khác vào danh sách
            voices.forEach(voice => {
                if (voice.lang !== 'ja-JP' && !voice.name.includes('Japanese')) {
                    const option = document.createElement('option');
                    option.textContent = `${voice.name} (${voice.lang})`;
                    option.value = voice.name;
                    voiceSelect.appendChild(option);
                }
            });

            if (!jaVoice) {
                errorText.textContent = "Cảnh báo: Trình duyệt không có giọng đọc tiếng Nhật (ja-JP). Sẽ sử dụng giọng mặc định cần có (có thể không phải tiếng Nhật).";
                errorMessage.classList.remove('hidden');
            } else {
                 errorMessage.classList.add('hidden');
            }
        }
        
        populateVoiceList();
        if (speechSynthesis.onvoiceschanged !== undefined) {
            speechSynthesis.onvoiceschanged = populateVoiceList;
        }

        rateRange.addEventListener('input', () => rateValue.textContent = rateRange.value);
        pitchRange.addEventListener('input', () => pitchValue.textContent = pitchRange.value);

        convertButton.addEventListener('click', () => {
            const num = parseInt(inputNumber.value.trim());
            errorMessage.classList.add('hidden');
            resultBox.classList.add('hidden');

            if (isNaN(num)) {
                errorText.textContent = "Lỗi: Vui lòng nhập một số hợp lệ.";
                errorMessage.classList.remove('hidden');
                return;
            }

            const romaji = convertToRomaji(num);

            if (romaji.startsWith("Số phải nằm")) {
                errorText.textContent = romaji;
                errorMessage.classList.remove('hidden');
            } else {
                const hiragana = romajiToHiragana(romaji);

                romajiOutput.textContent = romaji;
                hiraganaOutput.textContent = hiragana;
                
                resultBox.classList.remove('hidden');
                errorMessage.classList.add('hidden');
            }
        });

        speakerButton.addEventListener('click', () => {
            // Phát âm Hiragana để giọng đọc tự nhiên nhất
            const text = hiraganaOutput.textContent || romajiOutput.textContent; 
            if (!text) return;

            const utterance = new SpeechSynthesisUtterance(text);
            
            // Tìm giọng đọc được chọn
            const selectedVoiceName = voiceSelect.value;
            const selectedVoice = voices.find(voice => voice.name === selectedVoiceName);
            
            if (selectedVoice) {
                utterance.voice = selectedVoice;
            }

            // Đảm bảo ngôn ngữ được đặt là ja-JP để giọng đọc đúng tone
            utterance.lang = 'ja-JP';

            utterance.rate = parseFloat(rateRange.value);
            utterance.pitch = parseFloat(pitchRange.value);
            
            // Bắt lỗi phát âm
            utterance.onerror = (event) => {
                errorText.textContent = "Lỗi: Không thể phát âm thanh. Vui lòng thử lại sau.";
                errorMessage.classList.remove('hidden');
                setTimeout(() => errorMessage.classList.add('hidden'), 5000);
            };

            speechSynthesis.speak(utterance);
        });

        function copyToClipboard(text, buttonElement) {
            if (text) {
                // Sử dụng document.execCommand('copy') cho môi trường iframe
                const el = document.createElement('textarea');
                el.value = text;
                document.body.appendChild(el);
                el.select();
                document.execCommand('copy');
                document.body.removeChild(el);

                // Hiển thị thông báo sao chép thành công
                const originalText = buttonElement.innerHTML;
                buttonElement.innerHTML = '<i class="fas fa-check mr-1"></i> Xong!';
                buttonElement.style.backgroundColor = '#10B981'; // Xanh lá cây
                buttonElement.style.color = 'white';
                
                setTimeout(() => {
                    buttonElement.innerHTML = originalText;
                    buttonElement.style.backgroundColor = '';
                    buttonElement.style.color = '';
                }, 1500);
            }
        }

        copyRomajiButton.addEventListener('click', () => {
            copyToClipboard(romajiOutput.textContent, copyRomajiButton);
        });

        copyHiraganaButton.addEventListener('click', () => {
            copyToClipboard(hiraganaOutput.textContent, copyHiraganaButton);
        });

        // Xử lý sự kiện Enter
        inputNumber.addEventListener('keydown', (e) => {
            if (e.key === 'Enter') {
                convertButton.click();
            }
        });

    </script>
</body>
</html>
